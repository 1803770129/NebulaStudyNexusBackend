# 前端架构概述

## React 项目结构

```
src/
├── main.tsx              # 入口文件
├── App.tsx               # 根组件
├── components/           # 公共组件
│   ├── editor/           # 富文本编辑器
│   ├── layout/           # 布局组件
│   ├── question/         # 题目相关组件
│   └── AuthGuard/        # 路由守卫
├── hooks/                # 自定义 Hooks
├── lib/                  # 工具库
│   ├── apiClient.ts      # Axios 封装
│   └── queryClient.ts    # TanStack Query 配置
├── pages/                # 页面组件
├── router/               # 路由配置
├── services/             # API 服务层
├── types/                # TypeScript 类型
├── constants/            # 常量定义
└── utils/                # 工具函数
```

## 核心概念

### 1. 分层架构

```
┌─────────────────────────────────────────┐
│              Pages (页面)                │
│  组合组件，处理页面级逻辑                  │
└─────────────────┬───────────────────────┘
                  │
┌─────────────────▼───────────────────────┐
│              Hooks (钩子)                │
│  封装数据获取、状态管理                    │
└─────────────────┬───────────────────────┘
                  │
┌─────────────────▼───────────────────────┐
│            Services (服务)               │
│  API 调用、数据格式转换                   │
└─────────────────┬───────────────────────┘
                  │
┌─────────────────▼───────────────────────┐
│           API Client (客户端)            │
│  HTTP 请求、拦截器、错误处理              │
└─────────────────────────────────────────┘
```

### 2. 数据流

```typescript
// 1. 页面使用 Hook
function QuestionListPage() {
  const { questions, isLoading } = useQuestions(filters);
  return <QuestionTable data={questions} loading={isLoading} />;
}

// 2. Hook 使用 TanStack Query + Service
function useQuestions(filters: QuestionFilters) {
  return useQuery({
    queryKey: ['questions', filters],
    queryFn: () => getQuestions(filters),
  });
}

// 3. Service 调用 API Client
async function getQuestions(filters: QuestionFilters) {
  const response = await apiClient.get('/questions', filters);
  return response.data.map(convertToQuestion);
}

// 4. API Client 发送请求
const apiClient = axios.create({ baseURL: '/api' });
```

## 关键文件说明

### main.tsx - 入口文件

```typescript
import { StrictMode } from 'react';
import { createRoot } from 'react-dom/client';
import { QueryClientProvider } from '@tanstack/react-query';
import { queryClient } from './lib/queryClient';
import App from './App';

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <QueryClientProvider client={queryClient}>
      <App />
    </QueryClientProvider>
  </StrictMode>,
);
```

### App.tsx - 根组件

```typescript
import { RouterProvider } from 'react-router-dom';
import { ConfigProvider, App as AntApp, message } from 'antd';
import zhCN from 'antd/locale/zh_CN';
import { router } from './router';
import { setGlobalErrorHandler } from './lib/apiClient';
import { useEffect } from 'react';

function App() {
  const [messageApi, contextHolder] = message.useMessage();

  // 设置全局错误处理
  useEffect(() => {
    setGlobalErrorHandler((error) => {
      messageApi.error(error.message);
    });
  }, [messageApi]);

  return (
    <ConfigProvider locale={zhCN}>
      <AntApp>
        {contextHolder}
        <RouterProvider router={router} />
      </AntApp>
    </ConfigProvider>
  );
}
```

### router/index.tsx - 路由配置

```typescript
import { createBrowserRouter } from 'react-router-dom';
import { MainLayout } from '@/components/layout/MainLayout';
import { AuthGuard } from '@/components/AuthGuard';

export const router = createBrowserRouter([
  {
    path: '/login',
    element: <LoginPage />,
  },
  {
    path: '/',
    element: (
      <AuthGuard>
        <MainLayout />
      </AuthGuard>
    ),
    children: [
      { index: true, element: <Navigate to="/questions" /> },
      { path: 'questions', element: <QuestionListPage /> },
      { path: 'questions/new', element: <QuestionFormPage /> },
      { path: 'questions/:id/edit', element: <QuestionFormPage /> },
      { path: 'categories', element: <CategoryManagePage /> },
      { path: 'tags', element: <TagManagePage /> },
    ],
  },
]);
```

## 类型定义

```typescript
// types/index.ts

// 题目类型
export interface Question {
  id: string;
  title: string;
  content: RichContent;
  type: QuestionType;
  difficulty: DifficultyLevel;
  categoryId: string;
  tagIds: string[];
  options?: Option[];
  answer: string | string[];
  explanation?: RichContent;
  createdAt: string;
  updatedAt: string;
}

// 富文本内容
export interface RichContent {
  raw: string;
  rendered: string;
}

// 分页响应
export interface PaginatedResponse<T> {
  data: T[];
  total: number;
  page: number;
  pageSize: number;
}

// 枚举
export enum QuestionType {
  SINGLE_CHOICE = 'single_choice',
  MULTIPLE_CHOICE = 'multiple_choice',
  TRUE_FALSE = 'true_false',
  FILL_BLANK = 'fill_blank',
  SHORT_ANSWER = 'short_answer',
}

export enum DifficultyLevel {
  EASY = 'easy',
  MEDIUM = 'medium',
  HARD = 'hard',
}
```

## 环境配置

```typescript
// .env
VITE_API_BASE_URL=http://localhost:3000/api

// 使用
const apiUrl = import.meta.env.VITE_API_BASE_URL;
```

## 构建配置

```typescript
// vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import path from 'path';

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
  server: {
    port: 5173,
    proxy: {
      '/api': {
        target: 'http://localhost:3000',
        changeOrigin: true,
      },
    },
  },
});
```
