# 刷题系统增强前后端开发详细计划（按优先级执行）

## 1. 文档信息

- 文档版本：v1.0
- 日期：2026-02-21
- 适用范围：`question-backend`、`question-managing`、学生端业务接口与管理端页面
- 关联文档：
  - `docs/features/practice-system/01-PRD-ALL-LEVELS.md`
  - `docs/features/practice-system/02-PRODUCT-DELIVERY.md`
  - `docs/features/practice-system/03-TECH-ARCHITECTURE.md`
  - `docs/features/practice-system/04-TASK-BACKLOG.md`

## 2. 目标与执行原则

## 2.1 本阶段目标

1. 先完成 P0 全链路（会话练习 -> 提交判题 -> 主观批改 -> 错题复习 -> 模拟考试）。
2. 保持旧链路兼容（现有单题练习接口可继续使用）。
3. 每个迭代交付“可演示、可测试、可灰度”的完整增量。

## 2.2 执行原则

1. 后端先行：数据结构与接口冻结后，前端并行开发。
2. 小步交付：每周至少一个可验收增量。
3. 质量门禁：功能、测试、埋点、监控不完整不进入灰度。
4. 任务可追踪：所有任务按 `04-TASK-BACKLOG.md` ID 管理。

## 3. 开发优先级与范围

| 阶段 | 优先级 | 目标 | 是否本轮必做 |
|---|---|---|---|
| Stage-A | P0 | 会话练习能力 | 是 |
| Stage-B | P0 | 人工批改闭环 | 是 |
| Stage-C | P0 | 错题复习调度 | 是 |
| Stage-D | P0 | 模拟考试与报告 | 是 |
| Stage-E | P1 | 目标、掌握度、推荐 | 次轮 |
| Stage-F | P2 | 排行榜、提醒、周报 | 次轮 |
| Stage-G | P3 | AI讲解、自适应 | 探索 |

## 4. 迭代排期（详细）

## 4.1 里程碑与交付件

| 周次 | 里程碑 | 后端交付 | 前端交付 | 测试交付 |
|---|---|---|---|---|
| W1 | Sprint-0 | 开关框架、迁移基线、埋点模型 | 前端埋点框架、通用错误兜底 | E2E骨架、门禁接入 |
| W2-W3 | Sprint-1 | 会话表+接口+状态流转 | 会话入口/答题页/结果页 | 会话链路与恢复测试 |
| W4 | Sprint-2 | 批改任务表+接口+回写 | 批改工作台、学生结果展示 | 批改与权限测试 |
| W5 | Sprint-3 | 复习调度任务+到期接口 | 今日复习入口与流程 | 跨天调度测试 |
| W6 | Sprint-4 | 试卷/考试/交卷/报告接口 | 考试页、计时器、报告页 | 峰值与稳定性测试 |
| W7-W8 | Sprint-5 | 目标/掌握度/推荐接口 | 目标页、看板、推荐入口 | P1回归 |

## 4.2 每阶段完成定义（Gate）

### Gate-1（W1结束）

1. `BASE-*` 任务全部完成。
2. 迁移脚本可执行可回滚。
3. 灰度开关可独立控制。

### Gate-2（W3结束）

1. 会话练习主链路上线灰度。
2. 会话中断恢复通过E2E验证。
3. 核心接口监控可见。

### Gate-3（W6结束）

1. P0 四大能力全部联通。
2. 灰度阶段错误率与性能达标。
3. Go/No-Go 检查项全部通过。

## 5. 前后端协作计划

## 5.1 协作节奏

1. 每周一：需求边界和接口变更评审。
2. 每周三：后端接口联调窗口（Swagger + Mock校验）。
3. 每周五：集成演示与阻塞清理。

## 5.2 接口冻结策略

1. 每个 Sprint 第2个工作日冻结 DTO 字段。
2. 冻结后只允许增加可选字段，不允许破坏性变更。
3. 变更必须更新：
   - Swagger
   - 前端类型定义
   - 联调记录

## 5.3 并行开发策略

1. 后端先给出 API Contract（request/response/error）。
2. 前端先用 Mock 版本并行开发页面。
3. 接口可用后切换真实数据并完成回归。

## 6. 详细任务分解（开发顺序）

## 6.1 Stage-A（P0 会话练习，优先级最高）

执行顺序：

1. `SES-001` -> `SES-002` -> `SES-003`（数据层）
2. `SES-004` -> `SES-005` -> `SES-006`（服务与接口）
3. `SES-007` -> `SES-008` -> `SES-009`（页面）
4. `SES-011` -> `SES-010` -> `SES-012`（测试与埋点）

后端关键产出：

1. 会话创建/提交/恢复/完成接口。
2. 会话与记录关联字段。
3. 会话摘要计算能力。

前端关键产出：

1. 开始会话入口。
2. 会话答题流程页。
3. 会话结果页。

## 6.2 Stage-B（P0 人工批改）

执行顺序：

1. `GRD-001` -> `GRD-002` -> `GRD-003` -> `GRD-004`
2. `GRD-005` -> `GRD-006` -> `GRD-007`
3. `GRD-008` -> `GRD-009`

关键点：

1. 简答题提交后自动入池。
2. 批改回写必须具备审计字段。
3. 学生端必须可见评语结果。

## 6.3 Stage-C（P0 错题复习）

执行顺序：

1. `REV-001` -> `REV-002` -> `REV-003`
2. `REV-004` -> `REV-005`
3. `REV-006` -> `REV-007` -> `REV-008`
4. `REV-009` -> `REV-010`

关键点：

1. `next_review_at` 计算必须可重算。
2. 跨天调度需要时区一致性校验。
3. 今日复习与会话体系复用。

## 6.4 Stage-D（P0 模拟考试）

执行顺序：

1. `EXM-001` -> `EXM-002`
2. `EXM-003` -> `EXM-004` -> `EXM-005` -> `EXM-006`
3. `EXM-007` -> `EXM-008` -> `EXM-009`
4. `EXM-010` -> `EXM-011`

关键点：

1. 考试倒计时与自动交卷逻辑必须稳定。
2. 客观题自动判分，主观题接入批改任务。
3. 报告口径与成绩口径一致。

## 7. 代码与分支策略

## 7.1 分支命名

1. 功能分支：`feature/<task-id>-<short-name>`
2. 修复分支：`fix/<task-id>-<short-name>`
3. 发布分支：`release/<milestone>`

## 7.2 提交规范

1. `feat(module): ...`
2. `fix(module): ...`
3. `test(module): ...`
4. `docs(module): ...`

提交消息必须包含任务 ID（如 `SES-004`）。

## 7.3 合并门禁

1. 代码评审通过。
2. 单测通过。
3. 必要的 E2E 通过。
4. 文档同步更新（如接口变化）。

## 8. 测试计划

## 8.1 测试层级

1. 单元测试：服务规则、评分逻辑、调度算法。
2. 集成测试：模块间调用和数据库写入一致性。
3. E2E测试：学生端完整业务链路。
4. 性能测试：提交与考试交卷高峰场景。

## 8.2 每周测试节奏

1. 周中冒烟（新接口+关键页面）。
2. 周末回归（全链路）。
3. 里程碑前压测和回滚演练。

## 9. 监控与运维计划

## 9.1 监控项

1. 接口：错误率、延迟、超时。
2. 业务：会话完成率、批改积压、复习完成率、考试中断率。
3. 任务：调度失败次数、重试次数。

## 9.2 告警阈值（初始）

1. 提交接口错误率 > 2%（5分钟）。
2. 待批改任务 > 500。
3. 当日调度失败 > 50。
4. 考试交卷失败 > 1%。

## 10. 风险与应对

| 风险 | 触发信号 | 应对策略 |
|---|---|---|
| 接口频繁变更导致前端返工 | 同一Sprint多次破坏性变更 | 强制DTO冻结机制 |
| 批改任务积压 | 待批改持续上升 | 增加分配策略与人工值班 |
| 复习算法效果差 | 复习完成率或二次正确率不升反降 | 提供参数开关快速调参 |
| 考试高峰不稳定 | 考试提交超时上升 | 限流+异步判分+重试 |

## 11. 本周启动清单（立即执行）

## 11.1 Day 1

1. 锁定 Sprint-0 与 Sprint-1 任务范围。
2. 创建功能分支和任务看板。
3. 完成开关框架与迁移基线。

## 11.2 Day 2-3

1. 完成会话相关表迁移和实体定义。
2. 输出会话 API Contract。
3. 前端开始会话页面 Mock 开发。

## 11.3 Day 4-5

1. 完成会话接口第一版并联调。
2. 完成会话主流程页面第一版。
3. 完成首轮会话E2E用例。

## 12. 验收与交接

1. 每个 Sprint 结束输出：
   - Demo 视频或演示记录
   - 测试报告
   - 已知问题清单
   - 下周计划
2. 每个里程碑输出：
   - 版本说明
   - 监控截图
   - 回滚预案确认记录

